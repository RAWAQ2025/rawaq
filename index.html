<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>رواق | إدارة الحجوزات</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  margin:0;
}

.hidden { display:none; }

/* ===== تسجيل الدخول ===== */
#login {
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.login-box {
  background:white;
  padding:30px;
  width:300px;
  border-radius:8px;
  text-align:center;
}

.login-box input, .login-box button {
  width:100%;
  padding:10px;
  margin-top:10px;
}

.login-box button {
  background:#2563eb;
  color:white;
  border:none;
}

/* ===== النظام ===== */
.container {
  max-width:1200px;
  background:white;
  margin:20px auto;
  padding:20px;
  border-radius:8px;
}

label {
  font-weight:bold;
  display:block;
  margin-top:10px;
}

input, select, button {
  width:100%;
  padding:8px;
  margin-top:5px;
}

button {
  background:#2563eb;
  color:white;
  border:none;
  cursor:pointer;
  margin-top:15px;
}

/* ===== مشروبات ===== */
#drinkList span {
  background:#ddd;
  padding:5px 8px;
  border-radius:4px;
  margin:3px;
  display:inline-block;
  cursor:pointer;
}

/* ===== جدول ===== */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  font-size:14px;
}

th, td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}

th { background:#eee; }

/* ===== ألوان ===== */
.red { background:#fca5a5; }
.yellow { background:#fde68a; }
.green { background:#bbf7d0; }
</style>
</head>

<body>

<!-- تسجيل الدخول -->
<div id="login">
  <div class="login-box">
    <h3>الدخول للنظام</h3>
    <input type="password" id="password" placeholder="كلمة المرور">
    <button onclick="login()">دخول</button>
  </div>
</div>

<!-- النظام -->
<div id="app" class="hidden">
<div class="container">

<h2 style="text-align:center">إدارة حجوزات رواق</h2>

<form id="form">

<label>اسم العميل</label>
<input id="name" required>

<label>رقم الجوال</label>
<input id="phone" required>

<label>تاريخ الحجز</label>
<input type="date" id="bookingDate" required>

<label>تاريخ المناسبة</label>
<input type="date" id="eventDate" required>

<label>المشروبات</label>
<select id="drinkSelect">
  <option value="">اختر مشروب</option>
  <option>هوت شوكلت</option>
  <option>سحلب</option>
  <option>كرك</option>
  <option>كاسترد</option>
  <option>قهوة اللوز</option>
  <option>قهوة عربية</option>
  <option>شاهي أحمر</option>
  <option>تمر محشي</option>
  <option>معمول</option>
</select>

<button type="button" onclick="addDrink()">+ إضافة مشروب</button>
<div id="drinkList"></div>

<label>العربة</label>
<select id="cart" required>
  <option value="">اختر العربة</option>
  <option>كبيرة</option>
  <option>وسط</option>
  <option>صغيرة</option>
  <option>وسط وصغيرة</option>
</select>

<label>إجمالي الفاتورة</label>
<input type="number" id="total" required>

<label>الخصم</label>
<input type="number" id="discount" value="0">

<label>العربون</label>
<input type="number" id="deposit" value="0">

<label>التأمين</label>
<input type="number" id="insurance" value="0">

<button type="submit">تأكيد الحجز</button>

</form>

<table>
<thead>
<tr>
<th>العميل</th>
<th>الجوال</th>
<th>تاريخ الحجز</th>
<th>تاريخ المناسبة</th>
<th>العربة</th>
<th>المشروبات</th>
<th>الإجمالي</th>
<th>الخصم</th>
<th>الصافي</th>
<th>العربون</th>
<th>التأمين</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>
</div>

<script>
/* ===== كلمة المرور ===== */
const PASSWORD = "1234";

/* ===== دخول ===== */
function login() {
  if (password.value === PASSWORD) {
    loginDiv.style.display="none";
    app.classList.remove("hidden");
  } else {
    alert("كلمة المرور غير صحيحة");
  }
}

const loginDiv = document.getElementById("login");

/* ===== بيانات ===== */
let bookings = [];
let drinks = [];

/* ===== مشروبات ===== */
function addDrink() {
  if (!drinkSelect.value) return;
  drinks.push(drinkSelect.value);
  renderDrinks();
  drinkSelect.value="";
}

function renderDrinks() {
  drinkList.innerHTML="";
  drinks.forEach((d,i)=>{
    drinkList.innerHTML+=<span onclick="removeDrink(${i})">${d} ✖</span>;
  });
}

function removeDrink(i){
  drinks.splice(i,1);
  renderDrinks();
}

/* ===== ألوان ===== */
function rowColor(date){
  const diff=Math.ceil((new Date(date)-new Date())/86400000);
  if(diff<=2) return "red";
  if(diff<=5) return "yellow";
  return "green";
}

/* ===== إضافة حجز ===== */
form.onsubmit=e=>{
  e.preventDefault();

  if(drinks.length===0){
    alert("اختر مشروب واحد على الأقل");
    return;
  }

  if(bookings.find(b=>b.eventDate===eventDate.value && b.cart===cart.value)){
    alert("⚠️ العربة محجوزة في هذا التاريخ");
    return;
  }

  const finalTotal=total.value-discount.value;

  bookings.push({
    name:name.value,
    phone:phone.value,
    bookingDate:bookingDate.value,
    eventDate:eventDate.value,
    cart:cart.value,
    drinks:drinks.join("، "),
    total:total.value,
    discount:discount.value,
    finalTotal,
    deposit:deposit.value,
    insurance:insurance.value
  });

  bookings.sort((a,b)=>new Date(a.eventDate)-new Date(b.eventDate));
  renderTable();

  form.reset();
  drinks=[];
  renderDrinks();
};

/* ===== رسم الجدول ===== */
function renderTable(){
  tbody.innerHTML="";
  bookings.forEach(b=>{
    tbody.innerHTML+=`
    <tr class="${rowColor(b.eventDate)}">
      <td>${b.name}</td>
      <td>${b.phone}</td>
      <td>${b.bookingDate}</td>
      <td>${b.eventDate}</td>
      <td>${b.cart}</td>
      <td>${b.drinks}</td>
      <td>${b.total}</td>
      <td>${b.discount}</td>
      <td>${b.finalTotal}</td>
      <td>${b.deposit}</td>
      <td>${b.insurance}</td>
    </tr>`;
  });
}
</script>

</body>
</html>
