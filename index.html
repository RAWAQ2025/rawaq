<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>نظام إدارة الحجوزات</title>

<style>
body {
  font-family: Arial;
  direction: rtl;
  background: #f2f2f2;
}

.container {
  max-width: 1100px;
  margin: auto;
  background: white;
  padding: 20px;
}

input, select, button {
  width: 100%;
  padding: 8px;
  margin: 5px 0;
}

button {
  background: #1e40ff;
  color: white;
  border: none;
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

.red { background: #f8b4b4; }
.yellow { background: #fce38a; }
.green { background: #b7f7c0; }

.hidden { display: none; }
</style>
</head>

<body>

<!-- تسجيل الدخول -->
<div class="container" id="loginBox">
  <h3>الدخول للنظام</h3>
  <input type="password" id="password" placeholder="كلمة المرور">
  <button onclick="login()">دخول</button>
</div>

<!-- النظام -->
<div class="container hidden" id="systemBox">

<h3>إدارة الحجوزات</h3>

<form id="bookingForm">
  <input required placeholder="اسم العميل" id="name">
  <input required placeholder="رقم الجوال" id="phone">
  <label>تاريخ الحجز</label>
  <input type="date" required id="bookingDate">
  <label>تاريخ المناسبة</label>
  <input type="date" required id="eventDate">

  <input type="number" placeholder="إجمالي الفاتورة" id="total" required>
  <input type="number" placeholder="الخصم" id="discount" value="0">
  <input type="number" placeholder="العربون" id="deposit" value="0">
  <input type="number" placeholder="التأمين" id="insurance" value="0">

  <select id="cart" required>
    <option value="">اختر العربة</option>
    <option>كبيرة</option>
    <option>وسط</option>
    <option>صغيرة</option>
    <option>وسط + صغيرة</option>
  </select>

  <button type="submit">تأكيد الحجز</button>
</form>

<table>
<thead>
<tr>
  <th>الاسم</th>
  <th>المناسبة</th>
  <th>الصافي</th>
  <th>الخصم</th>
  <th>الإجمالي</th>
  <th>العربون</th>
  <th>التأمين</th>
  <th>العربة</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

</div>

<script>
let bookings = [];

function login() {
  if (document.getElementById("password").value === "1234") {
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("systemBox").classList.remove("hidden");
  } else {
    alert("كلمة المرور خطأ");
  }
}

document.getElementById("bookingForm").addEventListener("submit", function(e) {
  e.preventDefault();

  let eventDate = eventDateInput.value = document.getElementById("eventDate").value;
  let cart = document.getElementById("cart").value;

  if (bookings.some(b => b.eventDate === eventDate && b.cart === cart)) {
    alert("⚠️ العربة محجوزة في هذا اليوم");
    return;
  }

  let total = Number(document.getElementById("total").value);
  let discount = Number(document.getElementById("discount").value);
  let finalTotal = total - discount;

  bookings.push({
    name: name.value,
    eventDate,
    total,
    discount,
    finalTotal,
    deposit: deposit.value,
    insurance: insurance.value,
    cart
  });

  render();
  this.reset();
});

function render() {
  bookings.sort((a,b)=> new Date(a.eventDate)-new Date(b.eventDate));
  tableBody.innerHTML = "";

  bookings.forEach(b => {
    let days = (new Date(b.eventDate)-new Date())/(1000*60*60*24);
    let cls = days <= 2 ? "red" : days <= 5 ? "yellow" : "green";

    tableBody.innerHTML += `
    <tr class="${cls}">
      <td>${b.name}</td>
      <td>${b.eventDate}</td>
      <td>${b.finalTotal}</td>
      <td>${b.discount}</td>
      <td>${b.total}</td>
      <td>${b.deposit}</td>
      <td>${b.insurance}</td>
      <td>${b.cart}</td>
    </tr>`;
  });
}
</script>

</body>
</html>
