<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>رواق | إدارة الحجوزات</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
}

/* ===== شاشة كلمة المرور ===== */
#loginScreen {
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.login-box {
    background: white;
    padding: 30px;
    border-radius: 8px;
    width: 300px;
    text-align: center;
}

.login-box input, .login-box button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
}

.login-box button {
    background: #3b82f6;
    color: white;
    border: none;
    cursor: pointer;
}

/* ===== التطبيق ===== */
#app {
    display: none;
    padding: 20px;
}

.container {
    max-width: 1000px;
    background: white;
    margin: auto;
    padding: 20px;
    border-radius: 8px;
}

h1 {
    text-align: center;
}

label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
}

input, select, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}

button {
    background: #2563eb;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 15px;
}

/* ===== الجدول ===== */
table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    font-size: 14px;
}

th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}

th {
    background: #eee;
}

/* ===== الألوان ===== */
.red {
    background: #fca5a5;
}

.yellow {
    background: #fde68a;
}

.green {
    background: #bbf7d0;
}
</style>
</head>

<body>

<!-- ===== شاشة كلمة المرور ===== -->
<div id="loginScreen">
    <div class="login-box">
        <h3>الدخول للنظام</h3>
        <input type="password" id="passwordInput" placeholder="كلمة المرور">
        <button onclick="login()">دخول</button>
    </div>
</div>

<!-- ===== التطبيق ===== -->
<div id="app">
<div class="container">

<h1>إدارة حجوزات رواق</h1>

<form id="bookingForm">

<label>اسم العميل</label>
<input type="text" id="name" required>

<label>رقم الجوال</label>
<input type="tel" id="phone" required>

<label>تاريخ الحجز</label>
<input type="date" id="bookingDate" required>

<label>تاريخ المناسبة</label>
<input type="date" id="eventDate" required>

<label>العربة</label>
<select id="cart" required>
    <option value="">اختر العربة</option>
    <option value="كبيرة">كبيرة</option>
    <option value="وسط">وسط</option>
    <option value="صغيرة">صغيرة</option>
    <option value="وسط وصغيرة">وسط وصغيرة</option>
</select>

<label>إجمالي الفاتورة</label>
<input type="number" id="total" required>

<label>الخصم</label>
<input type="number" id="discount" value="0">

<label>العربون</label>
<input type="number" id="deposit" value="0">

<label>التأمين</label>
<input type="number" id="insurance" value="0">

<button type="submit">تأكيد الحجز</button>

</form>

<table>
<thead>
<tr>
<th>العميل</th>
<th>الجوال</th>
<th>تاريخ المناسبة</th>
<th>العربة</th>
<th>الإجمالي النهائي</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

</div>
</div>

<script>
/* ===== كلمة المرور (غيّرها هنا) ===== */
const SYSTEM_PASSWORD = "1234";

/* ===== تسجيل الدخول ===== */
function login() {
    const input = document.getElementById("passwordInput").value;
    if (input === SYSTEM_PASSWORD) {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("app").style.display = "block";
    } else {
        alert("❌ كلمة المرور غير صحيحة");
    }
}

/* ===== الحجوزات ===== */
let bookings = [];

document.getElementById("bookingForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const phone = document.getElementById("phone").value;
    const eventDate = document.getElementById("eventDate").value;
    const cart = document.getElementById("cart").value;
    const total = Number(document.getElementById("total").value);
    const discount = Number(document.getElementById("discount").value);

    /* تحذير حجز العربة */
    const conflict = bookings.find(b => b.eventDate === eventDate && b.cart === cart);
    if (conflict) {
        alert("⚠️ هذه العربة محجوزة في نفس تاريخ المناسبة");
        return;
    }

    const finalTotal = total - discount;

    bookings.push({ name, phone, eventDate, cart, finalTotal });

    bookings.sort((a, b) => new Date(a.eventDate) - new Date(b.eventDate));

    renderTable();
    this.reset();
    alert("✅ تم تسجيل الحجز");
});

/* ===== تلوين الصفوف ===== */
function getRowColor(dateStr) {
    const today = new Date();
    const eventDate = new Date(dateStr);
    const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));

    if (diffDays <= 2) return "red";
    if (diffDays <= 5) return "yellow";
    return "green";
}

function renderTable() {
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";

    bookings.forEach(b => {
        const colorClass = getRowColor(b.eventDate);
        tbody.innerHTML += `
        <tr class="${colorClass}">
            <td>${b.name}</td>
            <td>${b.phone}</td>
            <td>${b.eventDate}</td>
            <td>${b.cart}</td>
            <td>${b.finalTotal}</td>
        </tr>
        `;
    });
}
</script>

</body>
</html>
