<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø© | Ø±ÙˆØ§Ù‚</title>

<style>
body{
  font-family: Tahoma;
  background:#f7f7f7;
  padding:20px;
}
h2{
  color:#4b1d5a;
  text-align:center;
}
.box{
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
  box-shadow:0 2px 5px rgba(0,0,0,.1);
  line-height:1.8;
}
button{
  margin-top:10px;
  padding:8px 16px;
  background:#4b1d5a;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
a{
  display:inline-block;
  margin-top:20px;
  color:#4b1d5a;
  font-weight:bold;
  text-decoration:none;
}
.empty{
  text-align:center;
  color:#777;
}
</style>
</head>

<body>

<h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡Ø§</h2>
<div id="completedOrders"></div>
<a href="index.html">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

<script>
const orders = JSON.parse(localStorage.getItem("orders")) || [];
const completed = orders.filter(o => o.status === "ØªÙ…");
const box = document.getElementById("completedOrders");

if(completed.length === 0){
  box.innerHTML = '<p class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ù†Ø¬Ø²Ø©</p>';
}else{
  completed.forEach((o,i)=>{
    box.innerHTML += `
      <div class="box">
        <strong>${i+1}. ${o.name}</strong><br>
        Ø§Ù„Ø¬ÙˆØ§Ù„: ${o.phone}<br>
        ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©: ${o.eventDate}<br>
        Ø§Ù„Ø¹Ø±Ø¨Ø©: ${o.cart}<br>
        Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª: ${(o.drinks||[]).join(" ØŒ ")}<br>
        Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†: ${o.deposit}<br>
        Ø§Ù„ØªØ£Ù…ÙŠÙ†: ${o.insurance}<br>
        Ø§Ù„Ø®ØµÙ…: ${o.discount}<br>
        <strong>Ø§Ù„ØµØ§ÙÙŠ: ${o.net}</strong><br>

        <button onclick="openInvoice(${i})">ğŸ§¾ Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
      </div>
    `;
  });
}

/* ===== Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===== */
function openInvoice(i){
  const o = completed[i];

  let invNo = Number(localStorage.getItem("invoiceNo") || 0) + 1;
  localStorage.setItem("invoiceNo", invNo);

  const today = new Date().toLocaleDateString("ar-SA");
  const w = window.open("", "_blank");

  w.document.write(`
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ÙØ§ØªÙˆØ±Ø© Ø±ÙˆØ§Ù‚</title>
<style>
body{font-family:Tahoma;background:#eee;margin:0}
.invoice{max-width:720px;margin:30px auto;background:#fff;padding:25px;border-radius:12px}
.header{text-align:center;border-bottom:2px solid #4b1d5a;padding-bottom:15px}
.header img{max-width:120px;margin-bottom:10px}
.header h1{margin:0;color:#4b1d5a}
.meta{display:flex;justify-content:space-between;margin:15px 0}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:10px;text-align:center}
th{background:#4b1d5a;color:#fff}
.total{background:#f6eef8;font-weight:bold}
.net{background:#4b1d5a;color:#fff;font-size:18px}
button{margin-top:20px;padding:12px 25px;background:#4b1d5a;color:#fff;border:none;border-radius:8px}
@media print{button{display:none}}
</style>
</head>

<body>
<div class="invoice">

<div class="header">
  <!-- Ø­Ø· Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§ -->
  <!-- <img src="logo.png"> -->
  <h1>ÙØ§ØªÙˆØ±Ø© Ø±ÙˆØ§Ù‚</h1>
  <div>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
</div>

<div class="meta">
  <div>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invNo}</div>
  <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}</div>
</div>

<table>
<tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th></tr>
<tr><td>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</td><td>${o.name}</td></tr>
<tr><td>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</td><td>${o.phone}</td></tr>
<tr><td>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</td><td>${o.eventDate}</td></tr>
<tr><td>Ø§Ù„Ø¹Ø±Ø¨Ø©</td><td>${o.cart}</td></tr>
<tr><td>Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</td><td>${(o.drinks||[]).join(" ØŒ ")}</td></tr>

<tr class="total"><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</td><td>${o.total}</td></tr>
<tr class="total"><td>Ø§Ù„Ø®ØµÙ…</td><td>${o.discount}</td></tr>
<tr class="total"><td>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†</td><td>${o.deposit}</td></tr>
<tr class="total"><td>Ø§Ù„ØªØ£Ù…ÙŠÙ†</td><td>${o.insurance}</td></tr>

<tr class="net"><td>Ø§Ù„ØµØ§ÙÙŠ</td><td>${o.net}</td></tr>
</table>

<button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF</button>

</div>
</body>
</html>
`);
}
</script>

</body>
</html>
