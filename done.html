<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø© | Ø±ÙˆØ§Ù‚</title>
  <style>
    body {
      font-family: Tahoma, Arial;
      background: #f7f7f7;
      padding: 20px;
    }
    h2 {
      color: #4b1d5a;
      text-align: center;
      margin-bottom: 20px;
    }
    .box {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      line-height: 1.8;
    }
    .box strong {
      font-size: 16px;
      color: #4b1d5a;
    }
    button {
      margin-top: 10px;
      padding: 8px 15px;
      background: #4b1d5a;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    a {
      display: inline-block;
      margin-top: 20px;
      color: #4b1d5a;
      text-decoration: none;
      font-weight: bold;
    }
    .empty {
      text-align: center;
      color: #777;
    }
  </style>
</head>

<body>

<h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡Ø§</h2>

<div id="completedOrders"></div>

<a href="index.html">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

<script>
/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø© ===== */
const completed = JSON.parse(localStorage.getItem("completedOrders")) || [];
const container = document.getElementById("completedOrders");

if (completed.length === 0) {
  container.innerHTML = '<p class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ù†Ø¬Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
} else {
  completed.forEach((order, index) => {
    container.innerHTML += `
      <div class="box">
        <strong>${index + 1}. ${order.name}</strong><br>
        Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: ${order.phone}<br>
        ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©: ${order.date}<br>
        Ø§Ù„Ø¹Ø±Ø¨Ø©: ${order.cart}<br>
        Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª: ${(order.drinks || []).join(" ØŒ ")}<br>
        Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†: ${order.deposit}<br>
        Ø§Ù„ØªØ£Ù…ÙŠÙ†: ${order.insurance}<br>
        Ø§Ù„Ø®ØµÙ…: ${order.discount}<br>
        Ø§Ù„ØµØ§ÙÙŠ: <strong>${order.net}</strong><br>

        <button onclick="openInvoice(${index})">ğŸ§¾ ÙØ§ØªÙˆØ±Ø©</button>
      </div>
    `;
  });
}

/* ===== Ø¯Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===== */
function openInvoice(index){
  let completed = JSON.parse(localStorage.getItem("completedOrders")) || [];
  let o = completed[index];

  let invoiceNo = index + 1;
  let today = new Date().toLocaleDateString("ar-SA");

  let win = window.open("", "_blank");

  win.document.write(`
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ÙØ§ØªÙˆØ±Ø© Ø±ÙˆØ§Ù‚</title>
<style>
body{
  font-family: Tahoma;
  background:#f3f3f3;
  margin:0;
}
.invoice{
  max-width:700px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
}
.header{
  text-align:center;
  border-bottom:2px solid #4b1d5a;
  padding-bottom:15px;
}
.header h1{
  margin:0;
  color:#4b1d5a;
}
.meta{
  display:flex;
  justify-content:space-between;
  margin:15px 0;
  font-size:14px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}
th, td{
  padding:10px;
  border:1px solid #ddd;
  text-align:center;
}
th{
  background:#4b1d5a;
  color:#fff;
}
.total{
  background:#f6eef8;
  font-weight:bold;
}
.net{
  background:#4b1d5a;
  color:#fff;
  font-size:18px;
}
.footer{
  margin-top:25px;
  text-align:center;
}
button{
  padding:12px 25px;
  background:#4b1d5a;
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:16px;
}
@media print{
  button{display:none;}
}
</style>
</head>

<body>
<div class="invoice">

  <div class="header">
    <h1>ÙØ§ØªÙˆØ±Ø© Ø±ÙˆØ§Ù‚</h1>
    <div>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
  </div>

  <div class="meta">
    <div>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoiceNo}</div>
    <div>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${today}</div>
  </div>

  <table>
    <tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th></tr>
    <tr><td>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</td><td>${o.name}</td></tr>
    <tr><td>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</td><td>${o.phone}</td></tr>
    <tr><td>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</td><td>${o.date}</td></tr>
    <tr><td>Ø§Ù„Ø¹Ø±Ø¨Ø©</td><td>${o.cart}</td></tr>
    <tr><td>Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</td><td>${(o.drinks||[]).join(" ØŒ ")}</td></tr>

    <tr class="total"><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</td><td>${o.total}</td></tr>
    <tr class="total"><td>Ø§Ù„Ø®ØµÙ…</td><td>${o.discount}</td></tr>
    <tr class="total"><td>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†</td><td>${o.deposit}</td></tr>
    <tr class="total"><td>Ø§Ù„ØªØ£Ù…ÙŠÙ†</td><td>${o.insurance}</td></tr>

    <tr class="net"><td>Ø§Ù„ØµØ§ÙÙŠ</td><td>${o.net}</td></tr>
  </table>

  <div class="footer">
    <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
  </div>

</div>
</body>
</html>
`);
}
</script>

</body>
</html>
