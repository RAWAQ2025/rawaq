<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ø±ÙˆØ§Ù‚</title>

<style>
:root{
  --purple:#4b1f5c;
  --bg:#f4f1f6;
  --red:#f8d7da;
  --yellow:#fff3cd;
  --green:#d4edda;
}
body{
  margin:0;
  font-family:Tahoma,Arial;
  background:var(--bg);
}
.container{
  max-width:95%;
  margin:20px auto;
  background:#fff;
  padding:15px;
  border-radius:12px;
}
h2{
  text-align:center;
  color:var(--purple);
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:14px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
  vertical-align:top;
}
th{
  background:var(--purple);
  color:#fff;
}
.client-box{
  line-height:1.6;
  font-size:13px;
}
.money-box{
  line-height:1.6;
}
details summary{
  cursor:pointer;
  color:var(--purple);
  font-weight:bold;
}
details ul{
  padding-right:18px;
  margin:6px 0 0;
  text-align:right;
}
.btn{
  border:none;
  padding:5px 8px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
  margin:2px;
}
.done{background:#4b1f5c;color:#fff;}
.edit{background:#ffc107;}
.delete{background:#dc3545;color:#fff;}
.back-btn{
  margin-top:15px;
  width:100%;
  padding:12px;
  background:#ddd;
  color:#4b1f5c;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.empty{
  text-align:center;
  margin-top:20px;
  color:#777;
}
</style>
</head>

<body>

<script>
/* ğŸ” Ø­Ù…Ø§ÙŠØ© 5 Ø¯Ù‚Ø§Ø¦Ù‚ */
const MAX_TIME = 5 * 60 * 1000;
const loggedIn = sessionStorage.getItem("loggedIn");
const lastLogin = sessionStorage.getItem("lastLogin");

if(!loggedIn || !lastLogin || (Date.now() - lastLogin > MAX_TIME)){
  sessionStorage.clear();
  location.href = "login.html";
}
</script>

<div class="container">
<h2>Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>

<table>
<thead>
<tr>
  <th>#</th>
  <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
  <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²</th>
  <th>ØªØ§Ø±ÙŠØ® / ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</th>
  <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</th>
  <th>Ø§Ù„Ø¹Ø±Ø¨Ø©</th>
  <th>Ø§Ù„ØµØ§ÙÙŠ</th>
  <th>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† / Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
  <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div id="emptyMsg" class="empty" style="display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>
<button class="back-btn" onclick="location.href='index.html'">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
</div>

<script>
const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbwIh5xVrmfePd_t2h29cNyZSHmnw_ZX7RD6Wih1xXZ4kfkRUtC7d-BOX5Fgs_ENNm9c/exec";

fetch(GOOGLE_URL)
  .then(res => res.json())
  .then(data => renderOrders(data))
  .catch(() => alert("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ù‚ÙˆÙ‚Ù„"));

function renderOrders(orders){
  const body = document.getElementById("tableBody");
  const emptyMsg = document.getElementById("emptyMsg");
  body.innerHTML = "";

  const today = new Date();
  let counter = 1;
  let hasOrders = false;

  orders
    .filter(o => o.status === "Ø¬Ø¯ÙŠØ¯")
    .sort((a,b)=> new Date(a.eventDate) - new Date(b.eventDate))
    .forEach((order, index)=>{

      hasOrders = true;

      const eventDate = new Date(order.eventDate);
      const diff = Math.ceil((eventDate - today)/(1000*60*60*24));
      const color = diff<=2 ? "var(--red)" : diff<=5 ? "var(--yellow)" : "var(--green)";

      const tr = document.createElement("tr");
      tr.style.background = color;

      tr.innerHTML = `
        <td>${counter++}</td>

        <td class="client-box">
          <strong>${order.name || ""}</strong><br>
          ${order.phone || ""}
        </td>

        <td>${order.bookingDate || ""}</td>

        <td>
          <strong>${order.eventDate || ""}</strong><br>
          ${order.eventTime || ""}
        </td>

        <td>
          <details>
            <summary>Ø¹Ø±Ø¶</summary>
            <ul>
              ${(order.drinks || "").split("ØŒ").map(d=><li>${d}</li>).join("")}
            </ul>
          </details>
        </td>

        <td>${order.cart || ""}</td>

        <td>${order.net || 0}</td>

        <td class="money-box">
          Ø¹Ø±Ø¨ÙˆÙ†: ${order.deposit || 0}<br>
          ØªØ£Ù…ÙŠÙ†: ${order.insurance || 0}
        </td>

        <td>
          <button class="btn done">ØªÙ…Øª Ø§Ù„Ø®Ø¯Ù…Ø©</button>
          <button class="btn edit">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn delete">Ø­Ø°Ù</button>
        </td>
      `;
      body.appendChild(tr);
    });

  if(!hasOrders) emptyMsg.style.display="block";
}
</script>

</body>
</html>
