<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ / ØªØ¹Ø¯ÙŠÙ„ Ø·Ù„Ø¨ - Ø±ÙˆØ§Ù‚</title>

<style>
body{font-family:Tahoma;background:#f4f1f6;margin:0}
.container{
  max-width:600px;
  margin:30px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
}
h2{text-align:center;color:#4b1f5c}
label{display:block;margin-top:12px;font-weight:bold}
input,select{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  width:100%;
  margin-top:12px;
  padding:12px;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
.save{background:#4b1f5c;color:#fff}
.back{background:#ddd;color:#4b1f5c}
ul{padding-right:20px}
li{display:flex;justify-content:space-between}
.remove{background:none;border:none;color:red}
.net{background:#eee;padding:10px;border-radius:8px;margin-top:10px}
</style>
</head>

<body>

<div class="container">
<h2 id="title">ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>

<label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
<input id="name">

<label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
<input id="phone">

<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²</label>
<input type="date" id="bookingDate">

<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</label>
<input type="date" id="eventDate">

<label>Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</label>
<select id="drinkSelect">
  <option value="">Ø§Ø®ØªØ±</option>
  <option>Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª</option>
  <option>Ø³Ø­Ù„Ø¨</option>
  <option>ÙƒØ±Ùƒ</option>
  <option>Ù‚Ù‡ÙˆØ© Ø¹Ø±Ø¨ÙŠØ©</option>
</select>
<button onclick="addDrink()">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¨</button>

<ul id="drinkList"></ul>

<label>Ø§Ù„Ø¹Ø±Ø¨Ø©</label>
<select id="cart">
  <option value="">Ø§Ø®ØªØ±</option>
  <option>ÙƒØ¨ÙŠØ±Ø©</option>
  <option>ÙˆØ³Ø·</option>
  <option>ØµØºÙŠØ±Ø©</option>
</select>

<label>Ø§Ù„ØªØ£Ù…ÙŠÙ†</label>
<input type="number" id="insurance" value="0">

<label>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†</label>
<input type="number" id="deposit" value="0" oninput="calc()">

<label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
<input type="number" id="total" value="0" oninput="calc()">

<label>Ø§Ù„Ø®ØµÙ…</label>
<input type="number" id="discount" value="0" oninput="calc()">

<div class="net">
Ø§Ù„ØµØ§ÙÙŠ: <strong id="net">0</strong>
</div>

<button class="save" onclick="save()">Ø­ÙØ¸</button>
<button class="back" onclick="location.href='index.html'">Ø±Ø¬ÙˆØ¹</button>
</div>

<script>
/* ğŸ”— Ø±Ø§Ø¨Ø· Google Apps Script API */
const API_URL = "Ø¶Ø¹_Ø±Ø§Ø¨Ø·_exec_Ù‡Ù†Ø§";

let drinks = [];
let editOrder = null;

/* ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
if (sessionStorage.getItem("editOrder")) {
  editOrder = JSON.parse(sessionStorage.getItem("editOrder"));
  sessionStorage.removeItem("editOrder");

  title.innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨";

  name.value = editOrder.name || "";
  phone.value = editOrder.phone || "";
  bookingDate.value = editOrder.bookingDate || "";
  eventDate.value = editOrder.eventDate || "";
  cart.value = editOrder.cart || "";
  insurance.value = editOrder.insurance || 0;
  deposit.value = editOrder.deposit || 0;
  discount.value = editOrder.discount || 0;
  total.value = editOrder.total || 0;
  net.textContent = editOrder.net || 0;

  drinks = editOrder.drinks ? editOrder.drinks.split("ØŒ ") : [];
  render();
}

/* Ù…Ø´Ø±ÙˆØ¨Ø§Øª */
function addDrink(){
  if(!drinkSelect.value) return;
  drinks.push(drinkSelect.value);
  render();
}
function render(){
  drinkList.innerHTML="";
  drinks.forEach((d,i)=>{
    drinkList.innerHTML += `
      <li>${d}
        <button class="remove" onclick="del(${i})">âœ–</button>
      </li>`;
  });
}
function del(i){
  drinks.splice(i,1);
  render();
}

/* Ø­Ø³Ø§Ø¨ Ø§Ù„ØµØ§ÙÙŠ */
function calc(){
  const t = +total.value || 0;
  const d = +discount.value || 0;
  const a = +deposit.value || 0;
  net.textContent = Math.max(t - d - a, 0);
}

/* Ø­ÙØ¸ (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„) */
function save(){
  const order = {
    action: editOrder ? "updateOrder" : "addOrder",
    rowIndex: editOrder?.rowIndex,
    name: name.value,
    phone: phone.value,
    bookingDate: bookingDate.value,
    eventDate: eventDate.value,
    drinks: drinks.join("ØŒ "),
    cart: cart.value,
    insurance: insurance.value,
    deposit: deposit.value,
    discount: discount.value,
    total: total.value,
    net: net.textContent
  };

  fetch(API_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(order)
  })
  .then(r=>r.json())
  .then(()=>{
    alert(editOrder ? "ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ âœ…" : "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ âœ…");
    location.href="orders.html";
  });
}
</script>

</body>
</html>
